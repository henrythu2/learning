<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PKå¯¹æˆ˜ - Kids Word Learning</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .player-score {
            transition: all 0.3s ease;
        }
        .score-increase {
            animation: scoreUp 0.5s ease;
        }
        @keyframes scoreUp {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); color: #10b981; }
            100% { transform: scale(1); }
        }
        .vs-animation {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        .countdown-number {
            animation: countdownPop 1s ease;
        }
        @keyframes countdownPop {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.5); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        .choice-button {
            transition: all 0.2s ease;
        }
        .choice-button:active {
            transform: scale(0.95);
        }
        .correct-flash {
            animation: correctFlash 0.3s ease;
        }
        @keyframes correctFlash {
            0%, 100% { background-color: white; }
            50% { background-color: #10b981; }
        }
        .wrong-flash {
            animation: wrongFlash 0.3s ease;
        }
        @keyframes wrongFlash {
            0%, 100% { background-color: white; }
            50% { background-color: #ef4444; }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- é¡¶éƒ¨å¯¹æˆ˜ä¿¡æ¯ -->
    <div class="bg-gradient-to-r from-purple-600 to-pink-600 p-4 text-white">
        <div class="flex items-center justify-between mb-3">
            <button onclick="exitPK()" class="text-white/80">
                <i class="fas fa-times text-xl"></i>
            </button>
            <div class="text-center">
                <p class="text-sm opacity-90">PKå¯¹æˆ˜</p>
                <p id="timer" class="text-2xl font-bold">05:00</p>
            </div>
            <button class="invisible">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        
        <!-- å¯¹æˆ˜åŒæ–¹ä¿¡æ¯ -->
        <div class="flex items-center justify-between">
            <div class="text-center flex-1">
                <div class="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-1">
                    <span class="text-2xl">ğŸ‘¦</span>
                </div>
                <p class="font-medium">æˆ‘</p>
                <p id="myScore" class="text-3xl font-bold player-score">0</p>
            </div>
            
            <div class="text-4xl vs-animation mx-4">VS</div>
            
            <div class="text-center flex-1">
                <div class="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-1">
                    <span class="text-2xl">ğŸ‘§</span>
                </div>
                <p class="font-medium">å°çº¢</p>
                <p id="opponentScore" class="text-3xl font-bold player-score">0</p>
            </div>
        </div>
        
        <!-- è¿›åº¦å¯¹æ¯”æ¡ -->
        <div class="mt-4 bg-white/20 rounded-full h-3 relative overflow-hidden">
            <div id="myProgress" class="absolute left-0 top-0 h-full bg-blue-500 transition-all duration-300" style="width: 50%"></div>
            <div id="opponentProgress" class="absolute right-0 top-0 h-full bg-pink-500 transition-all duration-300" style="width: 50%"></div>
        </div>
    </div>

    <!-- æ¸¸æˆåŒºåŸŸ -->
    <div class="p-4">
        <!-- å€’è®¡æ—¶é®ç½© -->
        <div id="countdown" class="fixed inset-0 bg-black/80 flex items-center justify-center z-50">
            <div class="text-center">
                <p class="text-white text-2xl mb-4">å‡†å¤‡å¼€å§‹ï¼</p>
                <div id="countdownNumber" class="text-8xl font-bold text-white countdown-number">3</div>
            </div>
        </div>

        <!-- é¢˜ç›®åŒºåŸŸ -->
        <div class="text-center mb-6">
            <div class="bg-white rounded-2xl p-6 shadow-sm inline-block">
                <div id="questionEmoji" class="text-7xl mb-3">ğŸ</div>
                <p class="text-gray-600">é€‰æ‹©æ­£ç¡®çš„å•è¯</p>
            </div>
        </div>

        <!-- é€‰é¡¹åŒºåŸŸ -->
        <div id="choices" class="grid grid-cols-2 gap-3 max-w-md mx-auto">
            <!-- åŠ¨æ€ç”Ÿæˆé€‰é¡¹ -->
        </div>

        <!-- å¯¹æ‰‹çŠ¶æ€æç¤º -->
        <div id="opponentStatus" class="mt-6 text-center">
            <p class="text-sm text-gray-500">
                <i class="fas fa-circle text-green-500 text-xs mr-1"></i>
                å¯¹æ‰‹æ­£åœ¨ç­”é¢˜...
            </p>
        </div>
    </div>

    <!-- æ¸¸æˆç»“æŸå¼¹çª— -->
    <div id="gameOverModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-3xl p-8 text-center max-w-sm mx-4">
            <div id="resultIcon" class="text-6xl mb-4"></div>
            <h3 id="resultTitle" class="text-2xl font-bold text-gray-800 mb-2"></h3>
            <div class="flex items-center justify-center mb-4">
                <div class="text-center mx-4">
                    <p class="text-3xl font-bold text-blue-600" id="finalMyScore">0</p>
                    <p class="text-sm text-gray-500">æˆ‘</p>
                </div>
                <div class="text-2xl text-gray-400 mx-2">:</div>
                <div class="text-center mx-4">
                    <p class="text-3xl font-bold text-pink-600" id="finalOpponentScore">0</p>
                    <p class="text-sm text-gray-500">å°çº¢</p>
                </div>
            </div>
            <div id="rewardInfo" class="bg-gray-50 rounded-xl p-3 mb-4">
                <!-- å¥–åŠ±ä¿¡æ¯ -->
            </div>
            <div class="flex space-x-3">
                <button onclick="rematch()" class="flex-1 bg-indigo-600 text-white py-3 rounded-full font-medium">
                    å†æ¥ä¸€å±€
                </button>
                <button onclick="backToLeaderboard()" class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-full font-medium">
                    è¿”å›æ’è¡Œæ¦œ
                </button>
            </div>
        </div>
    </div>

    <script src="wordData.js"></script>
    <script>
        // æ¸¸æˆçŠ¶æ€
        let gameMode = 'speed'; // speed, accuracy, marathon
        let myScore = 0;
        let opponentScore = 0;
        let timeLeft = 300; // 5åˆ†é’Ÿ
        let gameTimer = null;
        let currentWord = null;
        let questionCount = 0;
        let correctCount = 0;
        let isGameActive = false;

        // è·å–æ¸¸æˆæ¨¡å¼
        const urlParams = new URLSearchParams(window.location.search);
        gameMode = urlParams.get('mode') || 'speed';

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            startCountdown();
        }

        // å¼€å§‹å€’è®¡æ—¶
        function startCountdown() {
            let count = 3;
            const countdownEl = document.getElementById('countdown');
            const numberEl = document.getElementById('countdownNumber');
            
            const countInterval = setInterval(() => {
                count--;
                if (count > 0) {
                    numberEl.textContent = count;
                    numberEl.className = 'text-8xl font-bold text-white countdown-number';
                } else if (count === 0) {
                    numberEl.textContent = 'GO!';
                    numberEl.className = 'text-8xl font-bold text-yellow-400 countdown-number';
                } else {
                    clearInterval(countInterval);
                    countdownEl.classList.add('hidden');
                    startGame();
                }
            }, 1000);
        }

        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            isGameActive = true;
            loadQuestion();
            startTimer();
            simulateOpponent();
        }

        // å¼€å§‹è®¡æ—¶å™¨
        function startTimer() {
            gameTimer = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    endGame();
                }
            }, 1000);
        }

        // æ›´æ–°è®¡æ—¶å™¨æ˜¾ç¤º
        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timer').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // åŠ è½½é¢˜ç›®
        function loadQuestion() {
            const categories = Object.keys(wordData);
            const randomCategory = categories[Math.floor(Math.random() * categories.length)];
            const words = wordData[randomCategory].words;
            
            currentWord = words[Math.floor(Math.random() * words.length)];
            
            // ç”Ÿæˆé€‰é¡¹
            const choices = [currentWord];
            const otherWords = words.filter(w => w.id !== currentWord.id);
            
            while (choices.length < 4 && otherWords.length > 0) {
                const randomIndex = Math.floor(Math.random() * otherWords.length);
                choices.push(otherWords[randomIndex]);
                otherWords.splice(randomIndex, 1);
            }
            
            // æ‰“ä¹±é€‰é¡¹
            choices.sort(() => Math.random() - 0.5);
            
            // æ›´æ–°UI
            document.getElementById('questionEmoji').textContent = currentWord.emoji;
            
            const choicesContainer = document.getElementById('choices');
            choicesContainer.innerHTML = '';
            
            choices.forEach(word => {
                const button = document.createElement('button');
                button.className = 'choice-button bg-white p-4 rounded-xl shadow-sm font-medium text-lg';
                button.textContent = word.word;
                button.onclick = () => checkAnswer(word, button);
                choicesContainer.appendChild(button);
            });
        }

        // æ£€æŸ¥ç­”æ¡ˆ
        function checkAnswer(selectedWord, button) {
            if (!isGameActive) return;
            
            questionCount++;
            
            if (selectedWord.id === currentWord.id) {
                // æ­£ç¡®
                correctCount++;
                myScore += 10;
                button.classList.add('correct-flash');
                updateMyScore();
            } else {
                // é”™è¯¯
                button.classList.add('wrong-flash');
                if (gameMode === 'marathon') {
                    // é©¬æ‹‰æ¾æ¨¡å¼ï¼Œé”™è¯¯å³ç»“æŸ
                    endGame();
                    return;
                }
            }
            
            // ç¦ç”¨æ‰€æœ‰æŒ‰é’®
            document.querySelectorAll('.choice-button').forEach(btn => {
                btn.disabled = true;
            });
            
            // åŠ è½½ä¸‹ä¸€é¢˜
            setTimeout(() => {
                loadQuestion();
            }, 500);
        }

        // æ›´æ–°æˆ‘çš„åˆ†æ•°
        function updateMyScore() {
            const scoreEl = document.getElementById('myScore');
            scoreEl.textContent = myScore;
            scoreEl.classList.add('score-increase');
            setTimeout(() => {
                scoreEl.classList.remove('score-increase');
            }, 500);
            
            updateProgressBar();
        }

        // æ¨¡æ‹Ÿå¯¹æ‰‹
        function simulateOpponent() {
            const opponentInterval = setInterval(() => {
                if (!isGameActive) {
                    clearInterval(opponentInterval);
                    return;
                }
                
                // éšæœºå†³å®šå¯¹æ‰‹æ˜¯å¦ç­”å¯¹
                if (Math.random() > 0.3) {
                    opponentScore += 10;
                    const scoreEl = document.getElementById('opponentScore');
                    scoreEl.textContent = opponentScore;
                    scoreEl.classList.add('score-increase');
                    setTimeout(() => {
                        scoreEl.classList.remove('score-increase');
                    }, 500);
                    
                    updateProgressBar();
                }
            }, 2000 + Math.random() * 2000);
        }

        // æ›´æ–°è¿›åº¦æ¡
        function updateProgressBar() {
            const total = myScore + opponentScore;
            if (total === 0) return;
            
            const myPercent = (myScore / total) * 100;
            const opponentPercent = (opponentScore / total) * 100;
            
            document.getElementById('myProgress').style.width = myPercent + '%';
            document.getElementById('opponentProgress').style.width = opponentPercent + '%';
        }

        // ç»“æŸæ¸¸æˆ
        function endGame() {
            isGameActive = false;
            clearInterval(gameTimer);
            
            // æ˜¾ç¤ºç»“æœ
            const modal = document.getElementById('gameOverModal');
            const resultIcon = document.getElementById('resultIcon');
            const resultTitle = document.getElementById('resultTitle');
            const rewardInfo = document.getElementById('rewardInfo');
            
            document.getElementById('finalMyScore').textContent = myScore;
            document.getElementById('finalOpponentScore').textContent = opponentScore;
            
            if (myScore > opponentScore) {
                resultIcon.innerHTML = 'ğŸ†';
                resultTitle.textContent = 'ä½ èµ¢äº†ï¼';
                rewardInfo.innerHTML = `
                    <p class="text-sm text-gray-600">è·å¾—å¥–åŠ±</p>
                    <div class="flex items-center justify-center space-x-4 mt-2">
                        <div><i class="fas fa-bolt text-yellow-500"></i> +${myScore} XP</div>
                        <div><i class="fas fa-trophy text-orange-500"></i> +1 èƒœåœº</div>
                    </div>
                `;
            } else if (myScore < opponentScore) {
                resultIcon.innerHTML = 'ğŸ˜”';
                resultTitle.textContent = 'å†æ¥å†å‰ï¼';
                rewardInfo.innerHTML = `
                    <p class="text-sm text-gray-600">è·å¾—å¥–åŠ±</p>
                    <div class="flex items-center justify-center">
                        <div><i class="fas fa-bolt text-yellow-500"></i> +${Math.floor(myScore * 0.5)} XP</div>
                    </div>
                `;
            } else {
                resultIcon.innerHTML = 'ğŸ¤';
                resultTitle.textContent = 'å¹³å±€ï¼';
                rewardInfo.innerHTML = `
                    <p class="text-sm text-gray-600">è·å¾—å¥–åŠ±</p>
                    <div class="flex items-center justify-center">
                        <div><i class="fas fa-bolt text-yellow-500"></i> +${Math.floor(myScore * 0.8)} XP</div>
                    </div>
                `;
            }
            
            modal.classList.remove('hidden');
        }

        // å†æ¥ä¸€å±€
        function rematch() {
            location.reload();
        }

        // è¿”å›æ’è¡Œæ¦œ
        function backToLeaderboard() {
            window.location.href = 'leaderboard.html';
        }

        // é€€å‡ºPK
        function exitPK() {
            if (confirm('ç¡®å®šè¦é€€å‡ºPKå—ï¼Ÿ')) {
                window.history.back();
            }
        }

        // åˆå§‹åŒ–
        initGame();
    </script>
</body>
</html>
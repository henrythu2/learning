<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PKÂØπÊàò - Kids Word Learning</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .player-score {
            transition: all 0.3s ease;
        }
        .score-increase {
            animation: scoreUp 0.5s ease;
        }
        @keyframes scoreUp {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); color: #10b981; }
            100% { transform: scale(1); }
        }
        .vs-animation {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        .countdown-number {
            animation: countdownPop 1s ease;
        }
        @keyframes countdownPop {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.5); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        .choice-button {
            transition: all 0.2s ease;
        }
        .choice-button:active {
            transform: scale(0.95);
        }
        .correct-flash {
            animation: correctFlash 0.3s ease;
        }
        @keyframes correctFlash {
            0%, 100% { background-color: white; }
            50% { background-color: #10b981; }
        }
        .wrong-flash {
            animation: wrongFlash 0.3s ease;
        }
        @keyframes wrongFlash {
            0%, 100% { background-color: white; }
            50% { background-color: #ef4444; }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- È°∂ÈÉ®ÂØπÊàò‰ø°ÊÅØ -->
    <div class="bg-gradient-to-r from-purple-600 to-pink-600 p-4 text-white">
        <div class="flex items-center justify-between mb-3">
            <button onclick="exitPK()" class="text-white/80">
                <i class="fas fa-times text-xl"></i>
            </button>
            <div class="text-center">
                <p class="text-sm opacity-90">PKÂØπÊàò</p>
                <p id="timer" class="text-2xl font-bold">05:00</p>
            </div>
            <button class="invisible">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        
        <!-- ÂØπÊàòÂèåÊñπ‰ø°ÊÅØ -->
        <div class="flex items-center justify-between">
            <div class="text-center flex-1">
                <div class="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-1">
                    <span class="text-2xl">üë¶</span>
                </div>
                <p class="font-medium">Êàë</p>
                <p id="myScore" class="text-3xl font-bold player-score">0</p>
            </div>
            
            <div class="text-4xl vs-animation mx-4">VS</div>
            
            <div class="text-center flex-1">
                <div class="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-1">
                    <span class="text-2xl">üëß</span>
                </div>
                <p class="font-medium">Â∞èÁ∫¢</p>
                <p id="opponentScore" class="text-3xl font-bold player-score">0</p>
            </div>
        </div>
        
        <!-- ËøõÂ∫¶ÂØπÊØîÊù° -->
        <div class="mt-4 bg-white/20 rounded-full h-3 relative overflow-hidden">
            <div id="myProgress" class="absolute left-0 top-0 h-full bg-blue-500 transition-all duration-300" style="width: 50%"></div>
            <div id="opponentProgress" class="absolute right-0 top-0 h-full bg-pink-500 transition-all duration-300" style="width: 50%"></div>
        </div>
    </div>

    <!-- Ê∏∏ÊàèÂå∫Âüü -->
    <div class="p-4">
        <!-- ÂÄíËÆ°Êó∂ÈÅÆÁΩ© -->
        <div id="countdown" class="fixed inset-0 bg-black/80 flex items-center justify-center z-50">
            <div class="text-center">
                <p class="text-white text-2xl mb-4">ÂáÜÂ§áÂºÄÂßãÔºÅ</p>
                <div id="countdownNumber" class="text-8xl font-bold text-white countdown-number">3</div>
            </div>
        </div>

        <!-- È¢òÁõÆÂå∫Âüü -->
        <div class="text-center mb-6">
            <div class="bg-white rounded-2xl p-6 shadow-sm inline-block">
                <div id="questionEmoji" class="text-7xl mb-3">üçé</div>
                <p class="text-gray-600">ÈÄâÊã©Ê≠£Á°ÆÁöÑÂçïËØç</p>
            </div>
        </div>

        <!-- ÈÄâÈ°πÂå∫Âüü -->
        <div id="choices" class="grid grid-cols-2 gap-3 max-w-md mx-auto">
            <!-- Âä®ÊÄÅÁîüÊàêÈÄâÈ°π -->
        </div>

        <!-- ÂØπÊâãÁä∂ÊÄÅÊèêÁ§∫ -->
        <div id="opponentStatus" class="mt-6 text-center">
            <p class="text-sm text-gray-500">
                <i class="fas fa-circle text-green-500 text-xs mr-1"></i>
                ÂØπÊâãÊ≠£Âú®Á≠îÈ¢ò...
            </p>
        </div>
    </div>

    <!-- Ê∏∏ÊàèÁªìÊùüÂºπÁ™ó -->
    <div id="gameOverModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-3xl p-8 text-center max-w-sm mx-4">
            <div id="resultIcon" class="text-6xl mb-4"></div>
            <h3 id="resultTitle" class="text-2xl font-bold text-gray-800 mb-2"></h3>
            <div class="flex items-center justify-center mb-4">
                <div class="text-center mx-4">
                    <p class="text-3xl font-bold text-blue-600" id="finalMyScore">0</p>
                    <p class="text-sm text-gray-500">Êàë</p>
                </div>
                <div class="text-2xl text-gray-400 mx-2">:</div>
                <div class="text-center mx-4">
                    <p class="text-3xl font-bold text-pink-600" id="finalOpponentScore">0</p>
                    <p class="text-sm text-gray-500">Â∞èÁ∫¢</p>
                </div>
            </div>
            <div id="rewardInfo" class="bg-gray-50 rounded-xl p-3 mb-4">
                <!-- Â•ñÂä±‰ø°ÊÅØ -->
            </div>
            <div class="flex space-x-3">
                <button onclick="rematch()" class="flex-1 bg-indigo-600 text-white py-3 rounded-full font-medium">
                    ÂÜçÊù•‰∏ÄÂ±Ä
                </button>
                <button onclick="backToLeaderboard()" class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-full font-medium">
                    ËøîÂõûÊéíË°åÊ¶ú
                </button>
            </div>
        </div>
    </div>

    <script src="wordData.js"></script>
    <script>
        // Ê∏∏ÊàèÁä∂ÊÄÅ
        let gameMode = 'speed'; // speed, accuracy, marathon
        let myScore = 0;
        let opponentScore = 0;
        let timeLeft = 300; // 5ÂàÜÈíü
        let gameTimer = null;
        let currentWord = null;
        let questionCount = 0;
        let correctCount = 0;
        let isGameActive = false;

        // Ëé∑ÂèñÊ∏∏ÊàèÊ®°Âºè
        const urlParams = new URLSearchParams(window.location.search);
        gameMode = urlParams.get('mode') || 'speed';

        // ÂàùÂßãÂåñÊ∏∏Êàè
        function initGame() {
            startCountdown();
        }

        // ÂºÄÂßãÂÄíËÆ°Êó∂
        function startCountdown() {
            let count = 3;
            const countdownEl = document.getElementById('countdown');
            const numberEl = document.getElementById('countdownNumber');
            
            const countInterval = setInterval(() => {
                count--;
                if (count > 0) {
                    numberEl.textContent = count;
                    numberEl.className = 'text-8xl font-bold text-white countdown-number';
                } else if (count === 0) {
                    numberEl.textContent = 'GO!';
                    numberEl.className = 'text-8xl font-bold text-yellow-400 countdown-number';
                } else {
                    clearInterval(countInterval);
                    countdownEl.classList.add('hidden');
                    startGame();
                }
            }, 1000);
        }

        // ÂºÄÂßãÊ∏∏Êàè
        function startGame() {
            isGameActive = true;
            loadQuestion();
            startTimer();
            simulateOpponent();
        }

        // ÂºÄÂßãËÆ°Êó∂Âô®
        function startTimer() {
            gameTimer = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    endGame();
                }
            }, 1000);
        }

        // Êõ¥Êñ∞ËÆ°Êó∂Âô®ÊòæÁ§∫
        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timer').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Âä†ËΩΩÈ¢òÁõÆ
        function loadQuestion() {
            const categories = Object.keys(wordData);
            const randomCategory = categories[Math.floor(Math.random() * categories.length)];
            const words = wordData[randomCategory].words;
            
            currentWord = words[Math.floor(Math.random() * words.length)];
            
            // ÁîüÊàêÈÄâÈ°π
            const choices = [currentWord];
            const otherWords = words.filter(w => w.id !== currentWord.id);
            
            while (choices.length < 4 && otherWords.length > 0) {
                const randomIndex = Math.floor(Math.random() * otherWords.length);
                choices.push(otherWords[randomIndex]);
                otherWords.splice(randomIndex, 1);
            }
            
            // Êâì‰π±ÈÄâÈ°π
            choices.sort(() => Math.random() - 0.5);
            
            // Êõ¥Êñ∞UI
            document.getElementById('questionEmoji').textContent = currentWord.emoji;
            
            const choicesContainer = document.getElementById('choices');
            choicesContainer.innerHTML = '';
            
            choices.forEach(word => {
                const button = document.createElement('button');
                button.className = 'choice-button bg-white p-4 rounded-xl shadow-sm font-medium text-lg';
                button.textContent = word.word;
                button.onclick = () => checkAnswer(word, button);
                choicesContainer.appendChild(button);
            });
        }

        // Ê£ÄÊü•Á≠îÊ°à
        function checkAnswer(selectedWord, button) {
            if (!isGameActive) return;
            
            questionCount++;
            
            if (selectedWord.id === currentWord.id) {
                // Ê≠£Á°Æ
                correctCount++;
                myScore += 10;
                button.classList.add('correct-flash');
                updateMyScore();
            } else {
                // ÈîôËØØ
                button.classList.add('wrong-flash');
                if (gameMode === 'marathon') {
                    // È©¨ÊãâÊùæÊ®°ÂºèÔºåÈîôËØØÂç≥ÁªìÊùü
                    endGame();
                    return;
                }
            }
            
            // Á¶ÅÁî®ÊâÄÊúâÊåâÈíÆ
            document.querySelectorAll('.choice-button').forEach(btn => {
                btn.disabled = true;
            });
            
            // Âä†ËΩΩ‰∏ã‰∏ÄÈ¢ò
            setTimeout(() => {
                loadQuestion();
            }, 500);
        }

        // Êõ¥Êñ∞ÊàëÁöÑÂàÜÊï∞
        function updateMyScore() {
            const scoreEl = document.getElementById('myScore');
            scoreEl.textContent = myScore;
            scoreEl.classList.add('score-increase');
            setTimeout(() => {
                scoreEl.classList.remove('score-increase');
            }, 500);
            
            updateProgressBar();
        }

        // Ê®°ÊãüÂØπÊâã
        function simulateOpponent() {
            const opponentInterval = setInterval(() => {
                if (!isGameActive) {
                    clearInterval(opponentInterval);
                    return;
                }
                
                // ÈöèÊú∫ÂÜ≥ÂÆöÂØπÊâãÊòØÂê¶Á≠îÂØπ
                if (Math.random() > 0.3) {
                    opponentScore += 10;
                    const scoreEl = document.getElementById('opponentScore');
                    scoreEl.textContent = opponentScore;
                    scoreEl.classList.add('score-increase');
                    setTimeout(() => {
                        scoreEl.classList.remove('score-increase');
                    }, 500);
                    
                    updateProgressBar();
                }
            }, 2000 + Math.random() * 2000);
        }

        // Êõ¥Êñ∞ËøõÂ∫¶Êù°
        function updateProgressBar() {
            const total = myScore + opponentScore;
            if (total === 0) return;
            
            const myPercent = (myScore / total) * 100;
            const opponentPercent = (opponentScore / total) * 100;
            
            document.getElementById('myProgress').style.width = myPercent + '%';
            document.getElementById('opponentProgress').style.width = opponentPercent + '%';
        }

        // ÁªìÊùüÊ∏∏Êàè
        function endGame() {
            isGameActive = false;
            clearInterval(gameTimer);
            
            // ÊòæÁ§∫ÁªìÊûú
            const modal = document.getElementById('gameOverModal');
            const resultIcon = document.getElementById('resultIcon');
            const resultTitle = document.getElementById('resultTitle');
            const rewardInfo = document.getElementById('rewardInfo');
            
            document.getElementById('finalMyScore').textContent = myScore;
            document.getElementById('finalOpponentScore').textContent = opponentScore;
            
            if (myScore > opponentScore) {
                resultIcon.innerHTML = 'üèÜ';
                resultTitle.textContent = '‰Ω†Ëµ¢‰∫ÜÔºÅ';
                rewardInfo.innerHTML = `
                    <p class="text-sm text-gray-600">Ëé∑ÂæóÂ•ñÂä±</p>
                    <div class="flex items-center justify-center space-x-4 mt-2">
                        <div><i class="fas fa-bolt text-yellow-500"></i> +${myScore} XP</div>
                        <div><i class="fas fa-trophy text-orange-500"></i> +1 ËÉúÂú∫</div>
                    </div>
                `;
            } else if (myScore < opponentScore) {
                resultIcon.innerHTML = 'üòî';
                resultTitle.textContent = 'ÂÜçÊé•ÂÜçÂéâÔºÅ';
                rewardInfo.innerHTML = `
                    <p class="text-sm text-gray-600">Ëé∑ÂæóÂ•ñÂä±</p>
                    <div class="flex items-center justify-center">
                        <div><i class="fas fa-bolt text-yellow-500"></i> +${Math.floor(myScore * 0.5)} XP</div>
                    </div>
                `;
            } else {
                resultIcon.innerHTML = 'ü§ù';
                resultTitle.textContent = 'Âπ≥Â±ÄÔºÅ';
                rewardInfo.innerHTML = `
                    <p class="text-sm text-gray-600">Ëé∑ÂæóÂ•ñÂä±</p>
                    <div class="flex items-center justify-center">
                        <div><i class="fas fa-bolt text-yellow-500"></i> +${Math.floor(myScore * 0.8)} XP</div>
                    </div>
                `;
            }
            
            modal.classList.remove('hidden');
        }

        // ÂÜçÊù•‰∏ÄÂ±Ä
        function rematch() {
            location.reload();
        }

        // ËøîÂõûÊéíË°åÊ¶ú
        function backToLeaderboard() {
            window.location.href = 'leaderboard.html';
        }

        // ÈÄÄÂá∫PK
        function exitPK() {
            if (confirm('Á°ÆÂÆöË¶ÅÈÄÄÂá∫PKÂêóÔºü')) {
                window.history.back();
            }
        }

        // ÂàùÂßãÂåñ
        initGame();
    </script>
</body>
</html>
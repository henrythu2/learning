<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•è¯é€‰æ‹© - Kids Word Learning</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .choice-button {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .choice-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        .choice-button:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }
        .choice-button.correct {
            background-color: #10b981 !important;
            color: white !important;
            animation: correctPulse 0.6s ease;
        }
        .choice-button.wrong {
            background-color: #ef4444 !important;
            color: white !important;
            animation: shake 0.5s ease;
        }
        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        .progress-star {
            transition: all 0.3s ease;
        }
        .progress-star.earned {
            color: #fbbf24;
            animation: starPop 0.5s ease;
        }
        @keyframes starPop {
            0% { transform: scale(0) rotate(0); }
            50% { transform: scale(1.3) rotate(180deg); }
            100% { transform: scale(1) rotate(360deg); }
        }
        .combo-badge {
            animation: comboBounce 0.5s ease;
        }
        @keyframes comboBounce {
            0% { transform: translateY(-20px) scale(0); }
            50% { transform: translateY(0) scale(1.1); }
            100% { transform: translateY(0) scale(1); }
        }
        .ripple {
            position: absolute;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.5);
            transform: scale(0);
            animation: ripple-effect 0.6s ease-out;
        }
        @keyframes ripple-effect {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <div class="bg-white p-4 shadow-sm">
        <div class="flex items-center justify-between mb-3">
            <button onclick="window.history.back()" class="text-gray-600">
                <i class="fas fa-arrow-left text-xl"></i>
            </button>
            <div class="flex items-center space-x-1">
                <i class="fas fa-star progress-star text-gray-300 text-2xl" id="star1"></i>
                <i class="fas fa-star progress-star text-gray-300 text-2xl" id="star2"></i>
                <i class="fas fa-star progress-star text-gray-300 text-2xl" id="star3"></i>
            </div>
            <div class="text-yellow-500">
                <i class="fas fa-bolt"></i>
                <span id="xpPoints" class="font-semibold">0</span>
            </div>
        </div>
        <div class="bg-gray-200 rounded-full h-3 relative">
            <div id="progressBar" class="bg-gradient-to-r from-yellow-400 to-yellow-500 h-full rounded-full transition-all duration-500" style="width: 0%"></div>
        </div>
    </div>

    <!-- æ¸¸æˆåŒºåŸŸ -->
    <div class="p-4">
        <!-- é¢˜ç›®åŒºåŸŸ -->
        <div class="text-center mb-6">
            <div class="bg-white rounded-3xl p-6 shadow-md inline-block">
                <div id="questionImage" class="text-8xl mb-4">ğŸ</div>
                <div class="flex justify-center space-x-2">
                    <button onclick="playSound()" class="bg-gray-100 p-2 rounded-full hover:bg-gray-200">
                        <i class="fas fa-volume-up text-gray-600"></i>
                    </button>
                    <button onclick="showHint()" id="hintButton" class="bg-yellow-100 p-2 rounded-full hover:bg-yellow-200">
                        <i class="fas fa-lightbulb text-yellow-600"></i>
                    </button>
                </div>
            </div>
            <p class="text-gray-600 mt-4 text-lg">è¿™æ˜¯ä»€ä¹ˆï¼Ÿ</p>
        </div>

        <!-- é€‰é¡¹æŒ‰é’® -->
        <div id="choicesContainer" class="space-y-3 max-w-md mx-auto">
            <!-- åŠ¨æ€ç”Ÿæˆé€‰é¡¹ -->
        </div>

        <!-- è¿å‡»æ˜¾ç¤º -->
        <div id="comboDisplay" class="fixed top-24 right-4 bg-orange-500 text-white px-4 py-2 rounded-full hidden combo-badge">
            <i class="fas fa-fire mr-2"></i>
            <span id="comboText">è¿å‡» x2</span>
        </div>

        <!-- æç¤ºæ˜¾ç¤º -->
        <div id="hintDisplay" class="mt-4 text-center hidden">
            <p class="text-gray-600 bg-yellow-50 inline-block px-4 py-2 rounded-full">
                <i class="fas fa-info-circle text-yellow-600 mr-2"></i>
                <span id="hintText"></span>
            </p>
        </div>
    </div>

    <!-- æˆå°±è§£é”å¼¹çª— -->
    <div id="achievementModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-3xl p-8 text-center max-w-sm mx-4 transform scale-0 transition-transform" id="achievementContent">
            <div class="text-6xl mb-4">ğŸ†</div>
            <h3 class="text-2xl font-bold text-gray-800 mb-2">æˆå°±è§£é”ï¼</h3>
            <p id="achievementText" class="text-gray-600 mb-4"></p>
            <button onclick="closeAchievement()" class="bg-yellow-500 text-white px-8 py-3 rounded-full font-semibold">
                å¤ªæ£’äº†ï¼
            </button>
        </div>
    </div>

    <script src="wordData.js"></script>
    <script>
        let currentWord = null;
        let choices = [];
        let totalXP = 0;
        let combo = 0;
        let questionsAnswered = 0;
        let correctAnswers = 0;
        let totalQuestions = 12;
        let hintUsed = false;
        let timeBonus = 0;
        let questionStartTime = 0;
        
        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            loadNewQuestion();
        }
        
        // åŠ è½½æ–°é¢˜ç›®
        function loadNewQuestion() {
            // è®°å½•å¼€å§‹æ—¶é—´ï¼ˆç”¨äºæ—¶é—´å¥–åŠ±ï¼‰
            questionStartTime = Date.now();
            hintUsed = false;
            document.getElementById('hintDisplay').classList.add('hidden');
            document.getElementById('hintButton').disabled = false;
            
            // éšæœºé€‰æ‹©ç±»åˆ«å’Œå•è¯
            const categories = Object.keys(wordData);
            const randomCategory = categories[Math.floor(Math.random() * categories.length)];
            const words = wordData[randomCategory].words;
            
            // é€‰æ‹©é¢˜ç›®
            currentWord = words[Math.floor(Math.random() * words.length)];
            
            // ç”Ÿæˆé€‰é¡¹
            choices = [currentWord];
            const otherWords = words.filter(w => w.id !== currentWord.id);
            
            // æ ¹æ®è¿›åº¦å¢åŠ éš¾åº¦ï¼ˆæ›´å¤šé€‰é¡¹ï¼‰
            const numChoices = Math.min(4 + Math.floor(questionsAnswered / 4), 6);
            
            while (choices.length < numChoices && otherWords.length > 0) {
                const randomIndex = Math.floor(Math.random() * otherWords.length);
                choices.push(otherWords[randomIndex]);
                otherWords.splice(randomIndex, 1);
            }
            
            // æ‰“ä¹±é€‰é¡¹
            choices.sort(() => 0.5 - Math.random());
            
            // æ›´æ–°UI
            updateQuestion();
            generateChoices();
            updateProgress();
        }
        
        // æ›´æ–°é¢˜ç›®æ˜¾ç¤º
        function updateQuestion() {
            document.getElementById('questionImage').textContent = currentWord.emoji;
        }
        
        // ç”Ÿæˆé€‰é¡¹æŒ‰é’®
        function generateChoices() {
            const container = document.getElementById('choicesContainer');
            container.innerHTML = '';
            
            choices.forEach((word, index) => {
                const button = document.createElement('button');
                button.className = 'choice-button w-full bg-white text-gray-800 py-4 px-6 rounded-2xl font-medium text-lg shadow-sm hover:bg-indigo-50 transition-all flex items-center justify-between relative';
                button.onclick = (e) => selectAnswer(word, button, e);
                
                button.innerHTML = `
                    <span>${word.word}</span>
                    <span class="text-gray-500 text-sm">${word.chinese}</span>
                `;
                
                container.appendChild(button);
            });
        }
        
        // é€‰æ‹©ç­”æ¡ˆ
        function selectAnswer(word, button, event) {
            // æ·»åŠ ç‚¹å‡»æ³¢çº¹æ•ˆæœ
            createRipple(event, button);
            
            // ç¦ç”¨æ‰€æœ‰æŒ‰é’®
            document.querySelectorAll('.choice-button').forEach(btn => {
                btn.disabled = true;
            });
            
            const isCorrect = word.id === currentWord.id;
            
            if (isCorrect) {
                // æ­£ç¡®ç­”æ¡ˆ
                button.classList.add('correct');
                correctAnswers++;
                combo++;
                
                // è®¡ç®—æ—¶é—´å¥–åŠ±
                const timeElapsed = (Date.now() - questionStartTime) / 1000;
                if (timeElapsed < 3) {
                    timeBonus = 3; // å¿«é€Ÿå›ç­”å¥–åŠ±
                } else if (timeElapsed < 5) {
                    timeBonus = 2;
                } else {
                    timeBonus = 1;
                }
                
                // è®¡ç®—æ€»ç»éªŒå€¼
                const baseXP = 5;
                const comboBonus = Math.min(combo - 1, 5) * 2;
                const hintPenalty = hintUsed ? -2 : 0;
                const earnedXP = baseXP + timeBonus + comboBonus + hintPenalty;
                
                totalXP += earnedXP;
                updateUI();
                
                // æ˜¾ç¤ºè¿å‡»
                if (combo > 1) {
                    showCombo();
                }
                
                // æ’­æ”¾æˆåŠŸéŸ³æ•ˆ
                playSuccessSound();
                
                // æ£€æŸ¥æˆå°±
                checkAchievements();
                
                setTimeout(nextQuestion, 1500);
            } else {
                // é”™è¯¯ç­”æ¡ˆ
                button.classList.add('wrong');
                combo = 0;
                
                // æ˜¾ç¤ºæ­£ç¡®ç­”æ¡ˆ
                const correctButton = Array.from(document.querySelectorAll('.choice-button')).find(
                    btn => btn.textContent.includes(currentWord.word)
                );
                if (correctButton) {
                    correctButton.classList.add('correct');
                }
                
                setTimeout(nextQuestion, 2000);
            }
        }
        
        // åˆ›å»ºç‚¹å‡»æ³¢çº¹æ•ˆæœ
        function createRipple(event, button) {
            const ripple = document.createElement('span');
            ripple.className = 'ripple';
            
            const rect = button.getBoundingClientRect();
            const size = Math.max(rect.width, rect.height);
            const x = event.clientX - rect.left - size / 2;
            const y = event.clientY - rect.top - size / 2;
            
            ripple.style.width = ripple.style.height = size + 'px';
            ripple.style.left = x + 'px';
            ripple.style.top = y + 'px';
            
            button.appendChild(ripple);
            
            setTimeout(() => ripple.remove(), 600);
        }
        
        // æ˜¾ç¤ºè¿å‡»
        function showCombo() {
            const display = document.getElementById('comboDisplay');
            const text = document.getElementById('comboText');
            
            text.textContent = `è¿å‡» x${combo}`;
            display.classList.remove('hidden');
            display.classList.add('combo-badge');
            
            setTimeout(() => {
                display.classList.add('hidden');
                display.classList.remove('combo-badge');
            }, 2000);
        }
        
        // æ’­æ”¾éŸ³æ•ˆ
        function playSound() {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(currentWord.word);
                utterance.lang = 'en-US';
                utterance.rate = 0.8;
                speechSynthesis.speak(utterance);
            }
        }
        
        // æ’­æ”¾æˆåŠŸéŸ³æ•ˆ
        function playSuccessSound() {
            // å¯ä»¥æ·»åŠ å®é™…çš„éŸ³æ•ˆæ–‡ä»¶
            // è¿™é‡Œç”¨ä¸€ä¸ªç®€å•çš„è§†è§‰åé¦ˆä»£æ›¿
            document.body.style.backgroundColor = '#f0fdf4';
            setTimeout(() => {
                document.body.style.backgroundColor = '#f9fafb';
            }, 300);
        }
        
        // æ˜¾ç¤ºæç¤º
        function showHint() {
            if (hintUsed) return;
            
            hintUsed = true;
            document.getElementById('hintButton').disabled = true;
            
            const hintDisplay = document.getElementById('hintDisplay');
            const hintText = document.getElementById('hintText');
            
            // æ˜¾ç¤ºå•è¯çš„ç¬¬ä¸€ä¸ªå­—æ¯
            hintText.textContent = `æç¤ºï¼šè¿™ä¸ªå•è¯ä»¥ "${currentWord.word[0].toUpperCase()}" å¼€å¤´`;
            hintDisplay.classList.remove('hidden');
        }
        
        // ä¸‹ä¸€é¢˜
        function nextQuestion() {
            questionsAnswered++;
            
            if (questionsAnswered >= totalQuestions) {
                // æ¸¸æˆç»“æŸ
                endGame();
            } else {
                loadNewQuestion();
            }
        }
        
        // æ£€æŸ¥æˆå°±
        function checkAchievements() {
            // æ›´æ–°æ˜Ÿæ˜Ÿè¿›åº¦
            const stars = Math.floor((correctAnswers / totalQuestions) * 3);
            for (let i = 1; i <= stars; i++) {
                const star = document.getElementById(`star${i}`);
                if (!star.classList.contains('earned')) {
                    star.classList.add('earned');
                }
            }
            
            // æ£€æŸ¥ç‰¹æ®Šæˆå°±
            if (combo === 5) {
                showAchievement('è¿å‡»å¤§å¸ˆ', 'è¿ç»­ç­”å¯¹5é¢˜ï¼');
            } else if (correctAnswers === 10 && questionsAnswered === 10) {
                showAchievement('å®Œç¾å¼€å±€', 'å‰10é¢˜å…¨éƒ¨ç­”å¯¹ï¼');
            }
        }
        
        // æ˜¾ç¤ºæˆå°±
        function showAchievement(title, description) {
            const modal = document.getElementById('achievementModal');
            const content = document.getElementById('achievementContent');
            const text = document.getElementById('achievementText');
            
            text.innerHTML = `<strong>${title}</strong><br>${description}`;
            modal.classList.remove('hidden');
            
            setTimeout(() => {
                content.style.transform = 'scale(1)';
            }, 100);
        }
        
        // å…³é—­æˆå°±å¼¹çª—
        function closeAchievement() {
            const modal = document.getElementById('achievementModal');
            const content = document.getElementById('achievementContent');
            
            content.style.transform = 'scale(0)';
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }
        
        // æ¸¸æˆç»“æŸ
        function endGame() {
            const accuracy = Math.round((correctAnswers / totalQuestions) * 100);
            const stars = Math.floor((correctAnswers / totalQuestions) * 3);
            
            alert(`æ¸¸æˆç»“æŸï¼
            
æ­£ç¡®ç‡ï¼š${accuracy}%
è·å¾—æ˜Ÿæ˜Ÿï¼š${'â­'.repeat(stars)}
æ€»ç»éªŒå€¼ï¼š${totalXP} XP
æœ€é«˜è¿å‡»ï¼š${combo}

ç»§ç»­åŠ æ²¹ï¼`);
            
            window.history.back();
        }
        
        // æ›´æ–°UI
        function updateUI() {
            document.getElementById('xpPoints').textContent = totalXP;
        }
        
        // æ›´æ–°è¿›åº¦æ¡
        function updateProgress() {
            const progress = (questionsAnswered / totalQuestions) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
        }
        
        // åˆå§‹åŒ–
        initGame();
    </script>
</body>
</html>